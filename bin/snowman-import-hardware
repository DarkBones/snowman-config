#!/usr/bin/env bash
set -euo pipefail

if [ $# -ne 1 ]; then
  echo "Usage: $0 <host-name>" >&2
  exit 1
fi

HOST="$1"
DEST_DIR="$(dirname "${BASH_SOURCE[0]}")/../hosts"
DEST_FILE="${DEST_DIR}/${HOST}-hardware-configuration.nix"

if [ ! -f /etc/nixos/hardware-configuration.nix ]; then
  echo "ERROR: /etc/nixos/hardware-configuration.nix not found. Are you on the installed system?" >&2
  exit 1
fi

mkdir -p "$DEST_DIR"

if [ -f "$DEST_FILE" ]; then
  echo "Refusing to overwrite existing $DEST_FILE" >&2
  exit 1
fi

cp /etc/nixos/hardware-configuration.nix "$DEST_FILE"
echo "✅ Copied /etc/nixos/hardware-configuration.nix → $DEST_FILE"
